(;; test/callcc.scm
main
    (set imd s0 524288)
    (set imd s1 1048575)
    (set reg v0 s0)
    (+ imd s0 s0 1)
    (set imd h0 L1)
    (store h0 v0 0)
    (set reg v1 s0)
    (+ imd s0 s0 1)
    (set imd h0 L2)
    (store h0 v1 0)
    (load imd v2 define 0)
    (set reg o0 define)
    (set reg o1 v0)
    (set reg o2 main)
    (set reg o3 v1)
    (call reg v2)
L1
    (halt)
L2
    (set reg v0 s0)
    (+ imd s0 s0 2)
    (set imd h0 L3)
    (store h0 v0 0)
    (store i1 v0 1)
    (set reg o0 v0)
    (set reg o1 v0)
    (call imd L4)
L3
    (load imd v0 i0 1)
    (+ imd v1 i1 48)
    (write-byte reg v1)
    (load imd v1 v0 0)
    (set reg o0 v0)
    (set imd o1 0)
    (call reg v1)
L4
    (set reg v0 s0)
    (+ imd s0 s0 2)
    (set imd h0 L5)
    (store h0 v0 0)
    (store i0 v0 1)
    (load imd v1 i1 0)
    (set reg o0 i1)
    (set reg o1 v0)
    (set imd o2 2)
    (call reg v1)
L5
    (load imd v0 i0 1)
    (+ imd v1 i1 1)
    (load imd v2 v0 0)
    (set reg o0 v0)
    (set reg o1 v1)
    (call reg v2)
)
